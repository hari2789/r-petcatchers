getgenv().Settings = {
    Versions = {
        ScriptVersion = "1.7a", 
        StableGameVersion = "1.01a" 
    },
    Toggles = { 
        ScriptEnabled = true, 
        KrakenRespawn = false, 
        BuyBlackMarket = false, 
        BuyGemTrader = false, 
    },
    Keybinds = {
        KrakenToggle = Enum.KeyCode.J, 
        BlackMarketToggle = Enum.KeyCode.K, 
        GemTraderToggle = Enum.KeyCode.L, 
        ToggleScript = Enum.KeyCode.U 
    },
    Timers = {
        RespawnCooldown = 4, 
        BuyDelay = 0.1, 
        BuyCooldown = 1, 
        CheckCooldown = 1, 
        NotificationDuration = 1 
    },
}

local UIS = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local function ActivityNotification(title, text)
    if Settings.Toggles.ScriptEnabled then
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = tostring(title),
            Text = tostring(text),
            Duration = Settings.Timers.NotificationDuration
        })
    end
end

local function ConsoleNotification(title, text)
    if Settings.Toggles.ScriptEnabled then
        print(tostring(title) .. " : " .. tostring(text))
    end
end

local function RespawnKraken()
    while true do
        if Settings.Toggles.KrakenRespawn and Settings.Toggles.ScriptEnabled then
            local success, errorMessage = pcall(function()
                ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
                    "Remote"):WaitForChild("Event"):FireServer("RespawnBoss", "the-kraken")
                wait(Settings.Timers.RespawnCooldown)
            end)

            if not success then
                warn("Error while respawning Kraken:", errorMessage)
            end
        else
            wait(Settings.Timers.CheckCooldown)
        end
    end
end

local function BuyItem(shop, itemIndex)
    local success, RemoteEvent = pcall(function()
        return ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
            "Remote"):WaitForChild("Event")
    end)
    if success then
        local result = RemoteEvent:FireServer("BuyShopItem", shop, itemIndex)
    else
        warn("Failed to find RemoteEvent for buying items from Black Market.")
    end
end

local function BuyBlackMarket()
    while true do
        if Settings.Toggles.BuyBlackMarket and Settings.Toggles.ScriptEnabled then
            for i = 1, 3 do
                BuyItem("the-blackmarket", i)
                wait(Settings.Timers.BuyDelay)
            end
            wait(Settings.Timers.BuyCooldown)
        else
            wait(Settings.Timers.CheckCooldown)
        end
    end
end

local function BuyGemTrader()
    while true do
        if Settings.Toggles.BuyGemTrader and Settings.Toggles.ScriptEnabled then
            for i = 1, 3 do
                BuyItem("gem-shop", i)
                wait(Settings.Timers.BuyDelay)
            end
            wait(Settings.Timers.BuyCooldown)
        else
            wait(Settings.Timers.CheckCooldown)
        end
    end
end

local function ToggleScript()
    Settings.Toggles.ScriptEnabled = not Settings.Toggles.ScriptEnabled
    if Settings.Toggles.ScriptEnabled then
        ActivityNotification("Script Enabled", "Press U to toggle the script off")
    else
        ActivityNotification("Script Disabled", "Press U to toggle the script on")
    end
end

print("Av / Hari")
print("Loaded script Version " .. tostring(Settings.Versions.ScriptVersion))
print("Works on game Version " .. tostring(Settings.Versions.StableGameVersion))
ActivityNotification("Status", "Script Has Been Loaded")
ActivityNotification("Kraken Auto Respawn", "Default: " .. tostring(Settings.Toggles.KrakenRespawn))
ActivityNotification("Black Market Auto Buy", "Default: " .. tostring(Settings.Toggles.BuyBlackMarket))
ActivityNotification("Script Enabled", "Script functionality is enabled.")

UIS.InputBegan:Connect(function(input)
    if input.KeyCode == Settings.Keybinds.KrakenToggle and Settings.Toggles.ScriptEnabled then
        Settings.Toggles.KrakenRespawn = not Settings.Toggles.KrakenRespawn
        ConsoleNotification("Kraken Auto Respawn is now:", Settings.Toggles.KrakenRespawn)
        ActivityNotification("Kraken Auto Respawn", "Status: " .. tostring(Settings.Toggles.KrakenRespawn))
    elseif input.KeyCode == Settings.Keybinds.BlackMarketToggle and Settings.Toggles.ScriptEnabled then
        Settings.Toggles.BuyBlackMarket = not Settings.Toggles.BuyBlackMarket
        ConsoleNotification("Black Market Auto Buy is now: ", Settings.Toggles.BuyBlackMarket)
        ActivityNotification("Black Market Auto Buy", "Status: " .. tostring(Settings.Toggles.BuyBlackMarket))
    elseif input.KeyCode == Settings.Keybinds.GemTraderToggle and Settings.Toggles.ScriptEnabled then
        Settings.Toggles.BuyGemTrader = not Settings.Toggles.BuyGemTrader
        ConsoleNotification("Gem Trader Auto Buy is now: ", Settings.Toggles.BuyGemTrader)
        ActivityNotification("Gem Trader Auto Buy", "Status: " .. tostring(Settings.Toggles.BuyGemTrader))
    elseif input.KeyCode == Settings.Keybinds.ToggleScript then
        ToggleScript()
    end
end)

coroutine.wrap(BuyBlackMarket)()
coroutine.wrap(RespawnKraken)()
