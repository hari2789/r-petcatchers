--[[

    Made by Av / Hari
    Version: v1.8
    Game Version: v1.1.2

    Press J to toggle Kraken respawn
    Press K to toggle Black Market auto buy
    Press U to toggle the script on/off

]]

local function InjectedScript()
    -- Settings and default configurations
    local Settings = {
        Toggles = { 
            ScriptEnabled = true, -- Toggle for enabling/disabling the script
            KrakenRespawn = false, -- Toggle for Kraken respawn
            BuyBlackMarket = false, -- Toggle for Black Market auto buy
            BuyGemTrader = false, -- Toggle for Gem Trader auto buy
        },
        Keybinds = {
            KrakenToggle = Enum.KeyCode.J, -- Keybind for toggling Kraken respawn
            BlackMarketToggle = Enum.KeyCode.K, -- Keybind for toggling Black Market auto buy
            GemTraderToggle = Enum.KeyCode.L, -- Keybind for toggling Gem Trader auto buy
            ToggleScript = Enum.KeyCode.U -- Keybind for enabling/disabling the script
        },
        Timers = {
            RespawnCooldown = 4, -- Wait time between Kraken respawns
            BuyDelay = 0.1, -- Delay between buying each item
            BuyCooldown = 1, -- Cooldown period after buying all items
            CheckCooldown = 1, -- Cooldown for checking if the actions should be performed
            NotificationDuration = 1 -- Duration of the notification
        },
        Versions = {
            ScriptVersion = "v1.8", -- Script Version
            StableGameVersion = "v1.1.2" -- Game Version
        }
    }

    -- Services
    local UIS = game:GetService("UserInputService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")

    -- Function to display notifications
    local function ActivityNotification(title, text)
        if Settings.Toggles.ScriptEnabled then
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = tostring(title),
                Text = tostring(text),
                Duration = Settings.Timers.NotificationDuration
            })
        end
    end

    -- Function to print notifications to the console
    local function ConsoleNotification(title, text)
        if Settings.Toggles.ScriptEnabled then
            print(tostring(title) .. " : " .. tostring(text))
        end
    end

    -- Function to respawn the Kraken
    local function RespawnKraken()
        while true do
            if Settings.Toggles.KrakenRespawn and Settings.Toggles.ScriptEnabled then
                local success, errorMessage = pcall(function()
                    ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
                        "Remote"):WaitForChild("Event"):FireServer("RespawnBoss", "the-kraken")
                    wait(Settings.Timers.RespawnCooldown)
                end)

                if not success then
                    warn("Error while respawning Kraken:", errorMessage)
                end
            else
                wait(Settings.Timers.CheckCooldown)
            end
        end
    end

    -- Function to buy an item from the Black Market
    local function BuyItem(shop, itemIndex)
        local success, RemoteEvent = pcall(function()
            return ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
                "Remote"):WaitForChild("Event")
        end)
        if success then
            local result = RemoteEvent:FireServer("BuyShopItem", shop, itemIndex)
        else
            warn("Failed to find RemoteEvent for buying items from Black Market.")
        end
    end

    -- Function to automatically buy items from the Black Market
    local function BuyBlackMarket()
        while true do
            if Settings.Toggles.BuyBlackMarket and Settings.Toggles.ScriptEnabled then
                for i = 1, 3 do
                    BuyItem("the-blackmarket", i)
                    wait(Settings.Timers.BuyDelay)
                end
                wait(Settings.Timers.BuyCooldown)
            else
                wait(Settings.Timers.CheckCooldown)
            end
        end
    end

    -- Function to automatically buy items from the Black Market
    local function BuyGemTrader()
        while true do
            if Settings.Toggles.BuyGemTrader and Settings.Toggles.ScriptEnabled then
                for i = 1, 3 do
                    BuyItem("gem-shop", i)
                    wait(Settings.Timers.BuyDelay)
                end
                wait(Settings.Timers.BuyCooldown)
            else
                wait(Settings.Timers.CheckCooldown)
            end
        end
    end

    -- Function to check if any TextBox or TextInput objects are focused
    local function IsTyping()
        for _, obj in ipairs(game.Players.LocalPlayer.PlayerGui:GetDescendants()) do
            if obj:IsA("TextBox") or obj:IsA("TextInput") then
                if obj:IsFocused() then
                    return true
                end
            end
        end
        return false
    end

    -- Function to toggle script enable/disable
    local function ToggleScript()
        Settings.Toggles.ScriptEnabled = not Settings.Toggles.ScriptEnabled
        if Settings.Toggles.ScriptEnabled then
            ConsoleNotification("Script Enabled", "Enabled")
            ActivityNotification("Script Enabled", "Press U to toggle the script off")
        else
            ConsoleNotification("Script Disabled", "Disabled")
            ActivityNotification("Script Disabled", "Press U to toggle the script on")
        end
    end

    -- Notify script loading and initial Settings
    warn("Av / Hari")
    warn("Loaded script Version " .. tostring(Settings.Versions.ScriptVersion))
    warn("Works on game Version " .. tostring(Settings.Versions.StableGameVersion))
    ActivityNotification("Status", "Script Has Been Loaded")
    ActivityNotification("Kraken Auto Respawn", "Default: " .. tostring(Settings.Toggles.KrakenRespawn))
    ActivityNotification("Black Market Auto Buy", "Default: " .. tostring(Settings.Toggles.BuyBlackMarket))
    ActivityNotification("Script Enabled", "Script functionality is enabled.")

    -- Listen for key presses to toggle Settings and enable/disable script
    local Mouse = LocalPlayer:GetMouse()
    Mouse.KeyDown:Connect(function(input)
        if IsTyping() then
            return
        end
        if input.KeyCode == Settings.Keybinds.KrakenToggle and Settings.Toggles.ScriptEnabled then
            Settings.Toggles.KrakenRespawn = not Settings.Toggles.KrakenRespawn
            ConsoleNotification("Kraken Auto Respawn is now:", Settings.Toggles.KrakenRespawn)
            ActivityNotification("Kraken Auto Respawn", "Status: " .. tostring(Settings.Toggles.KrakenRespawn))
        elseif input.KeyCode == Settings.Keybinds.BlackMarketToggle and Settings.Toggles.ScriptEnabled then
            Settings.Toggles.BuyBlackMarket = not Settings.Toggles.BuyBlackMarket
            ConsoleNotification("Black Market Auto Buy is now: ", Settings.Toggles.BuyBlackMarket)
            ActivityNotification("Black Market Auto Buy", "Status: " .. tostring(Settings.Toggles.BuyBlackMarket))
        elseif input.KeyCode == Settings.Keybinds.ToggleScript then
            ToggleScript()
        end
    end)

    -- Start the functions as coroutines
    coroutine.wrap(BuyBlackMarket)()
    coroutine.wrap(RespawnKraken)()
end

InjectedScript()  -- Call the encapsulated script function to execute the code
