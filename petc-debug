--[[

    Made by av / hari
    Version: 1.7
    Game Version: 1.01a

    Press J to toggle Kraken respawn
    Press K to toggle Black Market auto buy
    Press U to toggle the script on/off

]]

-- Settings and default configurations
local AvAvSettings = getgenv().AvSettings or {
    Versions = {
        ScriptVersion = "1.7a", -- Script version
        StableGameVersion = "1.01a" -- Game version
    },
    Toggles = { 
        ScriptEnabled = true, -- Toggle for enabling/disabling the script
        KrakenRespawn = false, -- Toggle for Kraken respawn
        BuyBlackMarket = false, -- Toggle for Black Market auto buy
        BuyGemTrader = false, -- Toggle for Gem Trader auto buy
    },
    Keybinds = {
        KrakenToggle = Enum.KeyCode.J, -- Keybind for toggling Kraken respawn
        BlackMarketToggle = Enum.KeyCode.K, -- Keybind for toggling Black Market auto buy
        GemTraderToggle = Enum.KeyCode.L, -- Keybind for toggling Gem Trader auto buy
        ToggleScript = Enum.KeyCode.U -- Keybind for enabling/disabling the script
    },
    Timers = {
        RespawnCooldown = 4, -- Wait time between Kraken respawns
        BuyDelay = 0.1, -- Delay between buying each item
        BuyCooldown = 1, -- Cooldown period after buying all items
        CheckCooldown = 1, -- Cooldown for checking if the actions should be performed
        NotificationDuration = 1 -- Duration of the notification
    },
}

-- Services
local UIS = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Function to display notifications
local function ActivityNotification(title, text)
    if AvSettings.Toggles.ScriptEnabled then
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = tostring(title),
            Text = tostring(text),
            Duration = AvSettings.Timers.NotificationDuration
        })
    end
end

-- Function to print notifications to the console
local function ConsoleNotification(title, text)
    if AvSettings.Toggles.ScriptEnabled then
        print(tostring(title) .. " : " .. tostring(text))
    end
end

-- Function to respawn the Kraken
local function RespawnKraken()
    while true do
        if AvSettings.Toggles.KrakenRespawn and AvSettings.Toggles.ScriptEnabled then
            local success, errorMessage = pcall(function()
                ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
                    "Remote"):WaitForChild("Event"):FireServer("RespawnBoss", "the-kraken")
                wait(AvSettings.Timers.RespawnCooldown)
            end)

            if not success then
                warn("Error while respawning Kraken:", errorMessage)
            end
        else
            wait(AvSettings.Timers.CheckCooldown)
        end
    end
end

-- Function to buy an item from the Black Market
local function BuyItem(shop, itemIndex)
    local success, RemoteEvent = pcall(function()
        return ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild(
            "Remote"):WaitForChild("Event")
    end)
    if success then
        local result = RemoteEvent:FireServer("BuyShopItem", shop, itemIndex)
    else
        warn("Failed to find RemoteEvent for buying items from Black Market.")
    end
end

-- Function to automatically buy items from the Black Market
local function BuyBlackMarket()
    while true do
        if AvSettings.Toggles.BuyBlackMarket and AvSettings.Toggles.ScriptEnabled then
            for i = 1, 3 do
                BuyItem("the-blackmarket", i)
                wait(AvSettings.Timers.BuyDelay)
            end
            wait(AvSettings.Timers.BuyCooldown)
        else
            wait(AvSettings.Timers.CheckCooldown)
        end
    end
end

-- Function to automatically buy items from the Black Market
local function BuyGemTrader()
    while true do
        if AvSettings.Toggles.BuyGemTrader and AvSettings.Toggles.ScriptEnabled then
            for i = 1, 3 do
                BuyItem("gem-shop", i)
                wait(AvSettings.Timers.BuyDelay)
            end
            wait(AvSettings.Timers.BuyCooldown)
        else
            wait(AvSettings.Timers.CheckCooldown)
        end
    end
end

-- Function to toggle script enable/disable
local function ToggleScript()
    AvSettings.Toggles.ScriptEnabled = not AvSettings.Toggles.ScriptEnabled
    if AvSettings.Toggles.ScriptEnabled then
        ActivityNotification("Script Enabled", "Press U to toggle the script off")
    else
        ActivityNotification("Script Disabled", "Press U to toggle the script on")
    end
end

-- Notify script loading and initial AvSettings
print("av / hari")
print("Loaded script version " .. tostring(AvSettings.ScriptVersion))
print("Works on game version " .. tostring(AvSettings.Versions.StableGameVersion))
ActivityNotification("Status", "Script Has Been Loaded")
ActivityNotification("Kraken Auto Respawn", "Default: " .. tostring(AvSettings.Toggles.KrakenRespawn))
ActivityNotification("Black Market Auto Buy", "Default: " .. tostring(AvSettings.Toggles.BuyBlackMarket))
ActivityNotification("Script Enabled", "Script functionality is enabled.")

-- Listen for key presses to toggle AvSettings and enable/disable script
UIS.InputBegan:Connect(function(input)
    if input.KeyCode == AvSettings.Keybinds.KrakenToggle and AvSettings.Toggles.ScriptEnabled then
        AvSettings.Toggles.KrakenRespawn = not AvSettings.Toggles.KrakenRespawn
        ConsoleNotification("Kraken Auto Respawn is now:", AvSettings.Toggles.KrakenRespawn)
        ActivityNotification("Kraken Auto Respawn", "Status: " .. tostring(AvSettings.Toggles.KrakenRespawn))
    elseif input.KeyCode == AvSettings.Keybinds.BlackMarketToggle and AvSettings.Toggles.ScriptEnabled then
        AvSettings.Toggles.BuyBlackMarket = not AvSettings.Toggles.BuyBlackMarket
        ConsoleNotification("Black Market Auto Buy is now: ", AvSettings.Toggles.BuyBlackMarket)
        ActivityNotification("Black Market Auto Buy", "Status: " .. tostring(AvSettings.Toggles.BuyBlackMarket))
    elseif input.KeyCode == AvSettings.Keybinds.GemTraderToggle and AvSettings.Toggles.ScriptEnabled then
        AvSettings.Toggles.BuyGemTrader = not AvSettings.Toggles.BuyGemTrader
        ConsoleNotification("Gem Trader Auto Buy is now: ", AvSettings.Toggles.BuyGemTrader)
        ActivityNotification("Gem Trader Auto Buy", "Status: " .. tostring(AvSettings.Toggles.BuyGemTrader))
    elseif input.KeyCode == AvSettings.Keybinds.ToggleScript then
        ToggleScript()
    end
end)

-- Start the functions as coroutines
coroutine.wrap(BuyBlackMarket)()
coroutine.wrap(RespawnKraken)()
